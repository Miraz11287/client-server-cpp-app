name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  create-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential cmake
    
    - name: Build project
      run: |
        mkdir build
        cd build
        cmake -DCMAKE_BUILD_TYPE=Release ..
        make -j$(nproc)
    
    - name: Generate documentation
      run: |
        chmod +x scripts/generate_docs.sh
        ./scripts/generate_docs.sh
    
    - name: Create release archive
      run: |
        mkdir -p dist
        tar -czf dist/client-server-app-${{ github.ref_name }}.tar.gz \
          --exclude=build \
          --exclude=.git \
          --exclude=dist \
          --exclude=.github \
          .
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.ref_name }}
        name: Release ${{ github.ref_name }}
        body: |
          ## üöÄ –†–µ–ª–∏–∑ ${{ github.ref_name }}
          
          ### üì¶ –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:
          - –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ C++
          - Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
          - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
          - –¢–µ—Å—Ç-–∫–µ–π—Å—ã –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤
          
          ### üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
          1. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ `client-server-app-${{ github.ref_name }}.tar.gz`
          2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ: `tar -xzf client-server-app-${{ github.ref_name }}.tar.gz`
          3. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: `make build`
          4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `make server`
          5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç: `make client`
          
          ### üê≥ Docker:
          ```bash
          docker build -t client-server-app .
          docker-compose up
          ```
          
          ### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
          - [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://miraz11287.github.io/client-server-cpp-app/)
          - [–î–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∞—Å—Å–æ–≤](docs/class_diagram.md)
          - [–¢–µ—Å—Ç-–∫–µ–π—Å—ã](tests/test_cases.md)
          
          ### üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
          –°–º. [—Å–ø–∏—Å–æ–∫ –¥–µ—Ñ–µ–∫—Ç–æ–≤](tests/defects.md)
          
          ### üìù Changelog:
          –°–º. [CHANGELOG.md](CHANGELOG.md)
        files: |
          dist/client-server-app-${{ github.ref_name }}.tar.gz
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
